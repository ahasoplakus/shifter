[
  {
    "objectID": "shift.html",
    "href": "shift.html",
    "title": "Creating a Shift Table in R",
    "section": "",
    "text": "We will focus on how to create such a laboratory shift table in a step-wise explanation."
  },
  {
    "objectID": "shift.html#required-packages",
    "href": "shift.html#required-packages",
    "title": "Creating a Shift Table in R",
    "section": "Required Packages",
    "text": "Required Packages\n\n\nCode\nsuppressPackageStartupMessages(library(dplyr))\nsuppressPackageStartupMessages(library(tidyr))\nsuppressPackageStartupMessages(library(rlang))\nsuppressPackageStartupMessages(library(purrr))\nsuppressPackageStartupMessages(library(stringr))\n\nwalk(list.files(here::here(\"R\"), pattern = \".R\", full.names = TRUE), source)"
  },
  {
    "objectID": "shift.html#data-used-for-analysis",
    "href": "shift.html#data-used-for-analysis",
    "title": "Creating a Shift Table in R",
    "section": "Data used for Analysis",
    "text": "Data used for Analysis\nThe following ADSL and ADLB ADaM datasets from {pharmaverseadam} R package are used in creation of shift table and help with understanding the programming process.\n\nADSLADLB\n\n\n\n\nCode\nadsl &lt;- pharmaverseadam::adsl\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nadlb &lt;- pharmaverseadam::adlb"
  },
  {
    "objectID": "shift.html#steps-to-create-a-shift-table",
    "href": "shift.html#steps-to-create-a-shift-table",
    "title": "Creating a Shift Table in R",
    "section": "Steps to create a Shift Table",
    "text": "Steps to create a Shift Table\n\n1. Calculating BIG N\nThe ADSL is the analysis dataset for each subject level. Initially subset the ADSL dataset with safety subjects only. Count number of subjects participating in each treatment group.\n\n\nCode\nadsl_bign &lt;- adsl |&gt;\n  na_to_missing() |&gt;\n  filter(.data$SAFFL == \"Y\") |&gt;\n  select(all_of(c(\"USUBJID\", \"TRT01A\"))) |&gt;\n  add_count(.data$TRT01A, name = \"TRT_N\")\n\n\n\n\n\n\n\n\n\n\n2. Pre-process Lab data\n\nFilter out missing values in BNRIND, ANRIND, AVAL\nMerge adsl to adlb to add BIG N\nKeep only Hemoglobin records which is our parameter of interest for this example\nSubset the ADLB dataset for safety subjects where analysis flag is equal to Y and at post-dose\nFilter out Unscheduled Visit records\nConcatenate BIG N with Treatment Labels in trt_var\n\n\n\nCode\nadlb_prep &lt;- adlb |&gt;\n  na_to_missing() |&gt;\n  mutate(across(all_of(c(\"BNRIND\", \"ANRIND\")), str_to_title)) |&gt;\n  left_join(adsl_bign) |&gt;\n  filter(\n    .data$ANL01FL == \"Y\",\n    !is.na(.data$AVAL),\n    .data$BNRIND != \"&lt;Missing&gt;\",\n    .data$ANRIND != \"&lt;Missing&gt;\",\n    .data$PARAMCD == \"HGB\",\n    str_detect(\n      toupper(.data$AVISIT),\n      \"UNSCHEDULED|BASELINE\",\n      negate = TRUE\n    )\n  ) |&gt;\n  mutate(trt_var = paste0(.data$TRT01A, \"&lt;br&gt;(N=\", TRT_N, \")\")) |&gt;\n  select(-TRT_N)\n\n\n\n\n\n\n\n\n Storing some table options (headers and labels) to use while displaying the final table \n\n\nCode\ntab_spanners &lt;- unique(adlb_prep$trt_var)\ntab_spanners\n\n\n[1] \"Placebo&lt;br&gt;(N=86)\"              \"Xanomeline High Dose&lt;br&gt;(N=72)\"\n[3] \"Xanomeline Low Dose&lt;br&gt;(N=96)\" \n\n\nCode\nm_tab_spanners &lt;- paste0(tab_spanners, \"&lt;br&gt;Baseline&lt;br&gt;n (%)\")\nm_tab_spanners\n\n\n[1] \"Placebo&lt;br&gt;(N=86)&lt;br&gt;Baseline&lt;br&gt;n (%)\"             \n[2] \"Xanomeline High Dose&lt;br&gt;(N=72)&lt;br&gt;Baseline&lt;br&gt;n (%)\"\n[3] \"Xanomeline Low Dose&lt;br&gt;(N=96)&lt;br&gt;Baseline&lt;br&gt;n (%)\" \n\n\nCode\nN_Placebo &lt;- get_trt_N(adsl_bign, \"TRT01A\", \"Placebo\")\nN_Placebo\n\n\n[1] 86\n\n\nCode\nN_Xano_High &lt;- get_trt_N(adsl_bign, \"TRT01A\", \"Xanomeline High Dose\")\nN_Xano_High\n\n\n[1] 72\n\n\nCode\nN_Xano_Low &lt;- get_trt_N(adsl_bign, \"TRT01A\", \"Xanomeline Low Dose\")\nN_Xano_Low\n\n\n[1] 96\n\n\n\n\n3. Creating a dummy dataset to get all combinations of ANRIND and BNRIND\n\n\nCode\nall_anrind_comb &lt;- expand_grid(\n  trt_var = unique(adlb_prep[[\"trt_var\"]]),\n  AVISIT = intersect(levels(as.factor(adlb_prep[[\"AVISIT\"]])), unique(adlb_prep[[\"AVISIT\"]])),\n  BNRIND = as.factor(c(\"Low\", \"Normal\", \"High\", \"Total\"))\n) |&gt;\n  cross_join(tibble(ANRIND = as.factor(c(\"Low\", \"Normal\", \"High\"))))\n\n\n\n\n\n\n\n\n\n\n4. Performing Counts\n\n\nCode\nshift_counts &lt;- adlb_prep |&gt;\n  bind_rows(mutate(adlb_prep, BNRIND = \"Total\")) |&gt;\n  group_by(!!!syms(c(\"trt_var\", \"AVISITN\", \"ANRIND\", \"BNRIND\"))) |&gt;\n  count(.data[[\"AVISIT\"]], name = \"CNT\") |&gt;\n  ungroup() |&gt;\n  full_join(all_anrind_comb, by = c(\"trt_var\", \"AVISIT\", \"BNRIND\", \"ANRIND\")) |&gt;\n  mutate(across(\"CNT\", ~ replace_na(.x, 0))) |&gt;\n  arrange(\n    .data[[\"trt_var\"]],\n    factor(.data[[\"BNRIND\"]], levels = c(\"Low\", \"Normal\", \"High\", \"Total\")),\n    factor(.data[[\"ANRIND\"]], levels = c(\"Low\", \"Normal\", \"High\", \"Total\")),\n    .data[[\"AVISITN\"]]\n  ) |&gt;\n  select(-all_of(\"AVISITN\"))\n\n\n\n\n\n\n\n\n\n\n5. Reshape Data and count Grade Totals\n\n\nCode\nshift_wide &lt;- shift_counts |&gt;\n  pivot_wider(\n    id_cols = all_of(c(\"AVISIT\", \"ANRIND\")),\n    names_from = all_of(c(\"trt_var\", \"BNRIND\")),\n    values_from = \"CNT\",\n    names_sep = \"&lt;-&gt;\"\n  )\n\npost_base_grade_totals &lt;- shift_wide |&gt;\n  summarize(across(where(is.numeric), sum), .by = all_of(\"AVISIT\")) |&gt;\n  mutate(ANRIND = \"Total\")\n\nshift_final &lt;- shift_wide |&gt;\n  bind_rows(post_base_grade_totals)\n\n\nThe same could be attained by creating a function build_shift_table() which covers Steps 3-5\n\n\nCode\nshift_final &lt;-\n  build_shift_table(\n    bds_dataset = adlb_prep,\n    trt_var = exprs(trt_var),\n    analysis_grade_var = exprs(ANRIND),\n    base_grade_var = exprs(BNRIND),\n    grade_var_order = exprs(Low, Normal, High),\n    visit_var = exprs(AVISIT, AVISITN)\n  )\n\n\n\n\n\n\n\n\n\n\n6. Display the final table\n\n\nCode\nshift_final |&gt;\n  gt::gt(groupname_col = \"AVISIT\", row_group_as_column = TRUE) |&gt;\n  gt::cols_label(ANRIND = gt::md(\"Post&lt;br&gt;Dose\")) |&gt;\n  gt::cols_label_with(columns = contains(\"&lt;-&gt;\"), \\(x) custom_split(x, \"&lt;-&gt;\")) |&gt;\n  gt::tab_spanner(columns = contains(tab_spanners[1]), label = gt::md(m_tab_spanners[1])) |&gt;\n  gt::tab_spanner(columns = contains(tab_spanners[2]), label = gt::md(m_tab_spanners[2])) |&gt;\n  gt::tab_spanner(columns = contains(tab_spanners[3]), label = gt::md(m_tab_spanners[3])) |&gt;\n  gt::opt_table_font(font =  \"monospace-slab-serif\") |&gt;\n  gt::text_transform(\n    fn = \\(x) add_pct(x, N_Placebo, 2),\n    locations = gt::cells_body(columns = contains(tab_spanners[1]))\n  ) |&gt;\n  gt::text_transform(\n    fn = \\(x) add_pct(x, N_Xano_High, 2),\n    locations = gt::cells_body(columns = contains(tab_spanners[2]))\n  ) |&gt;\n  gt::text_transform(\n    fn = \\(x) add_pct(x, N_Xano_Low, 2),\n    locations = gt::cells_body(columns = contains(tab_spanners[3]))\n  ) |&gt;\n  gt::tab_stubhead(gt::md(\"Analysis Visit\")) |&gt;\n  gt::tab_source_note(source_note = \"This is a source note.\") |&gt;\n  gt::tab_footnote(\n    footnote = \"This is a footnote.\",\n    locations = gt::cells_body(columns = 1, rows = 1)\n  ) |&gt;\n  gt::tab_header(\n    title = gt::md(\"Table x.x&lt;br&gt;Shift Table of Lab Hematology&lt;br&gt;(Full Safety Analysis Set)\"),\n    subtitle = \"Parameter: Hemoglobin\"\n  ) |&gt;\n  gt::opt_table_lines()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTable x.x\nShift Table of Lab Hematology\n(Full Safety Analysis Set)\n\n\nParameter: Hemoglobin\n\n\nAnalysis Visit\nPost\nDose\nPlacebo\n(N=86)\nBaseline\nn (%)\nXanomeline High Dose\n(N=72)\nBaseline\nn (%)\nXanomeline Low Dose\n(N=96)\nBaseline\nn (%)\n\n\nLow\nNormal\nHigh\nTotal\nLow\nNormal\nHigh\nTotal\nLow\nNormal\nHigh\nTotal\n\n\n\n\nWeek 2\nLow\n4 (4.65)\n2 (2.33)\n0 (0)\n6 (6.98)\n1 (1.39)\n3 (4.17)\n0 (0)\n4 (5.56)\n4 (4.17)\n0 (0)\n0 (0)\n4 (4.17)\n\n\nNormal\n3 (3.49)\n73 (84.88)\n0 (0)\n76 (88.37)\n0 (0)\n65 (90.28)\n2 (2.78)\n67 (93.06)\n1 (1.04)\n67 (69.79)\n1 (1.04)\n69 (71.88)\n\n\nHigh\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n\n\nTotal\n7 (8.14)\n75 (87.21)\n0 (0)\n82 (95.35)\n1 (1.39)\n68 (94.44)\n2 (2.78)\n71 (98.61)\n5 (5.21)\n67 (69.79)\n1 (1.04)\n73 (76.04)\n\n\nWeek 4\nLow\n4 (4.65)\n2 (2.33)\n0 (0)\n6 (6.98)\n1 (1.39)\n0 (0)\n0 (0)\n1 (1.39)\n4 (4.17)\n2 (2.08)\n0 (0)\n6 (6.25)\n\n\nNormal\n1 (1.16)\n68 (79.07)\n0 (0)\n69 (80.23)\n0 (0)\n63 (87.5)\n1 (1.39)\n64 (88.89)\n1 (1.04)\n57 (59.38)\n0 (0)\n58 (60.42)\n\n\nHigh\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n\n\nTotal\n5 (5.81)\n70 (81.4)\n0 (0)\n75 (87.21)\n1 (1.39)\n64 (88.89)\n1 (1.39)\n66 (91.67)\n5 (5.21)\n59 (61.46)\n0 (0)\n64 (66.67)\n\n\nWeek 6\nLow\n3 (3.49)\n1 (1.16)\n0 (0)\n4 (4.65)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n4 (4.17)\n3 (3.12)\n0 (0)\n7 (7.29)\n\n\nNormal\n2 (2.33)\n64 (74.42)\n0 (0)\n66 (76.74)\n0 (0)\n51 (70.83)\n1 (1.39)\n52 (72.22)\n1 (1.04)\n50 (52.08)\n0 (0)\n51 (53.12)\n\n\nHigh\n0 (0)\n1 (1.16)\n0 (0)\n1 (1.16)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n\n\nTotal\n5 (5.81)\n66 (76.74)\n0 (0)\n71 (82.56)\n0 (0)\n53 (73.61)\n1 (1.39)\n54 (75)\n5 (5.21)\n53 (55.21)\n0 (0)\n58 (60.42)\n\n\nWeek 8\nLow\n5 (5.81)\n2 (2.33)\n0 (0)\n7 (8.14)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n3 (3.12)\n0 (0)\n0 (0)\n3 (3.12)\n\n\nNormal\n1 (1.16)\n62 (72.09)\n0 (0)\n63 (73.26)\n0 (0)\n50 (69.44)\n1 (1.39)\n51 (70.83)\n2 (2.08)\n48 (50)\n0 (0)\n50 (52.08)\n\n\nHigh\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n\n\nTotal\n6 (6.98)\n64 (74.42)\n0 (0)\n70 (81.4)\n0 (0)\n51 (70.83)\n1 (1.39)\n52 (72.22)\n5 (5.21)\n48 (50)\n0 (0)\n53 (55.21)\n\n\nWeek 12\nLow\n4 (4.65)\n1 (1.16)\n0 (0)\n5 (5.81)\n0 (0)\n2 (2.78)\n0 (0)\n2 (2.78)\n3 (3.12)\n1 (1.04)\n0 (0)\n4 (4.17)\n\n\nNormal\n1 (1.16)\n58 (67.44)\n0 (0)\n59 (68.6)\n0 (0)\n38 (52.78)\n1 (1.39)\n39 (54.17)\n1 (1.04)\n34 (35.42)\n0 (0)\n35 (36.46)\n\n\nHigh\n0 (0)\n1 (1.16)\n0 (0)\n1 (1.16)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n\n\nTotal\n5 (5.81)\n60 (69.77)\n0 (0)\n65 (75.58)\n0 (0)\n41 (56.94)\n1 (1.39)\n42 (58.33)\n4 (4.17)\n35 (36.46)\n0 (0)\n39 (40.62)\n\n\nWeek 16\nLow\n4 (4.65)\n1 (1.16)\n0 (0)\n5 (5.81)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n4 (4.17)\n0 (0)\n0 (0)\n4 (4.17)\n\n\nNormal\n2 (2.33)\n59 (68.6)\n0 (0)\n61 (70.93)\n0 (0)\n31 (43.06)\n1 (1.39)\n32 (44.44)\n1 (1.04)\n27 (28.12)\n0 (0)\n28 (29.17)\n\n\nHigh\n0 (0)\n1 (1.16)\n0 (0)\n1 (1.16)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n\n\nTotal\n6 (6.98)\n61 (70.93)\n0 (0)\n67 (77.91)\n0 (0)\n32 (44.44)\n1 (1.39)\n33 (45.83)\n5 (5.21)\n27 (28.12)\n0 (0)\n32 (33.33)\n\n\nWeek 20\nLow\n4 (4.65)\n1 (1.16)\n0 (0)\n5 (5.81)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n3 (3.12)\n0 (0)\n0 (0)\n3 (3.12)\n\n\nNormal\n2 (2.33)\n53 (61.63)\n0 (0)\n55 (63.95)\n0 (0)\n27 (37.5)\n1 (1.39)\n28 (38.89)\n0 (0)\n23 (23.96)\n0 (0)\n23 (23.96)\n\n\nHigh\n0 (0)\n1 (1.16)\n0 (0)\n1 (1.16)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n\n\nTotal\n6 (6.98)\n55 (63.95)\n0 (0)\n61 (70.93)\n0 (0)\n28 (38.89)\n1 (1.39)\n29 (40.28)\n3 (3.12)\n23 (23.96)\n0 (0)\n26 (27.08)\n\n\nWeek 24\nLow\n5 (5.81)\n4 (4.65)\n0 (0)\n9 (10.47)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n2 (2.08)\n1 (1.04)\n0 (0)\n3 (3.12)\n\n\nNormal\n0 (0)\n49 (56.98)\n0 (0)\n49 (56.98)\n0 (0)\n25 (34.72)\n1 (1.39)\n26 (36.11)\n0 (0)\n20 (20.83)\n0 (0)\n20 (20.83)\n\n\nHigh\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n\n\nTotal\n5 (5.81)\n53 (61.63)\n0 (0)\n58 (67.44)\n0 (0)\n27 (37.5)\n1 (1.39)\n28 (38.89)\n2 (2.08)\n21 (21.88)\n0 (0)\n23 (23.96)\n\n\nWeek 26\nLow\n4 (4.65)\n1 (1.16)\n0 (0)\n5 (5.81)\n0 (0)\n1 (1.39)\n0 (0)\n1 (1.39)\n2 (2.08)\n0 (0)\n0 (0)\n2 (2.08)\n\n\nNormal\n1 (1.16)\n44 (51.16)\n0 (0)\n45 (52.33)\n0 (0)\n23 (31.94)\n0 (0)\n23 (31.94)\n0 (0)\n20 (20.83)\n0 (0)\n20 (20.83)\n\n\nHigh\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n0 (0)\n\n\nTotal\n5 (5.81)\n45 (52.33)\n0 (0)\n50 (58.14)\n0 (0)\n24 (33.33)\n0 (0)\n24 (33.33)\n2 (2.08)\n20 (20.83)\n0 (0)\n22 (22.92)\n\n\n\nThis is a source note."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "References",
    "section": "",
    "text": "About this site\n\n\nCode\n1 + 1\n\n\n[1] 2"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "A Tidy approach to create Shift Tables using {tidyverse} and {gt}",
    "section": "",
    "text": "The main purpose of shift tables in any clinical trial is to determine how the categorical result varies from baseline to post-dose.\nIt is important to look at the effect of the drug by comparing values at baseline and post –baseline in any clinical trials. Shift table is one of the analysis approaches suggested in E3 Guidelines to show the number of patients who are low, normal, or high at baseline and then at selected time intervals. It’s easier to figure out any abnormality in data because the layout helps to get the count of subjects at two time points together. Shift tables can be created for any data like labs, vital signs and ECG etc.\n\n\n\nAll safety related data is collected in a clinical trial study for safety analysis. The laboratory data is one of the most important parts of safety analysis in any drug discovery study. The data mapping team and Statistical Programmers in the clinical programming department support the clinical data analysis and reporting process. The data mapping team analyzes and creates SDTM datasets from raw datasets. The Statistical Programming team creates the ADaM datasets and generates reports in a clinical study. ADaM data structure is such that, it has all the necessary variables needed to create reporting code and this makes the job easier for programmers.\nThere are several summary tables commonly used to produce laboratory results. Descriptive statistics, clinically significance, shift tables and toxicity grade summaries are some of the summary tables that are commonly used. The shift table is one of the most frequently requested in a clinical study by statisticians or clinicians. The site that provides the laboratory results usually produces the normal ranges for numeric lab tests. The study team analyzes the lab results based on normal range and then flags or categorizes whether it is low, normal or high.\n\n\n\n\n\n\nShift Table"
  },
  {
    "objectID": "index.html#shift-tables-in-clinical-trials",
    "href": "index.html#shift-tables-in-clinical-trials",
    "title": "A Tidy approach to create Shift Tables using {tidyverse} and {gt}",
    "section": "",
    "text": "The main purpose of shift tables in any clinical trial is to determine how the categorical result varies from baseline to post-dose.\nIt is important to look at the effect of the drug by comparing values at baseline and post –baseline in any clinical trials. Shift table is one of the analysis approaches suggested in E3 Guidelines to show the number of patients who are low, normal, or high at baseline and then at selected time intervals. It’s easier to figure out any abnormality in data because the layout helps to get the count of subjects at two time points together. Shift tables can be created for any data like labs, vital signs and ECG etc.\n\n\n\nAll safety related data is collected in a clinical trial study for safety analysis. The laboratory data is one of the most important parts of safety analysis in any drug discovery study. The data mapping team and Statistical Programmers in the clinical programming department support the clinical data analysis and reporting process. The data mapping team analyzes and creates SDTM datasets from raw datasets. The Statistical Programming team creates the ADaM datasets and generates reports in a clinical study. ADaM data structure is such that, it has all the necessary variables needed to create reporting code and this makes the job easier for programmers.\nThere are several summary tables commonly used to produce laboratory results. Descriptive statistics, clinically significance, shift tables and toxicity grade summaries are some of the summary tables that are commonly used. The shift table is one of the most frequently requested in a clinical study by statisticians or clinicians. The site that provides the laboratory results usually produces the normal ranges for numeric lab tests. The study team analyzes the lab results based on normal range and then flags or categorizes whether it is low, normal or high.\n\n\n\n\n\n\nShift Table"
  }
]